-----------------------------------
-- NPC: Tim Allen
-- for mission 2-1 of Decent
-----------------------------------
require("modules/module_utils")
require("scripts/zones/Abdhaljs_Isle-Purgonorgo/Zone")
require("scripts/globals/npc_util")
require("scripts/globals/utils")
-----------------------------------
local m = Module:new("Timmy")
m:setEnabled(true)

m:addOverride("xi.zones.Abdhaljs_Isle-Purgonorgo.Zone.onInitialize", function(zone)

    super(zone)

	
local Tim = zone:insertDynamicEntity({

    objtype = xi.objType.NPC,
    name = "Tim Allen",
    look = 3598,
    x = 556.000,
    y = -1.000,
    z = 60.000,
		
	widescan = 1,

    onTrade = function(player, npc, trade)
		if player:getCharVar("TimStuff") == 1 then
			if trade:hasItemQty(3934, 4) and trade:hasItemQty(8986, 2) and trade:hasItemQty(8709, 2) then
				player:PrintToPlayer("Thank Altana, we'll be able to make a nice secure door with this.",0, npc:getPacketName())
				player:PrintToPlayer("These materials will kill the scent left behind by survivors, thank you.", 13)
				player:setCharVar("TimStuff", 2)
			else
				player:PrintToPlayer("This doesn't seem right,", 0, npc:getPacketName())
				player:PrintToPlayer("I need 4 matamata shells, along with 2 Joyous's Moss, and 2 Raaz Hides.", 13)
			end
		else
			player:PrintToPlayer("Sorry, not looking for materials at the moment.", 0, npc:getPacketName())
		end
	end,
	
	onTrigger = function(player, npc, status)
		TimStuff = player:getCharVar("TimStuff")
		if player:getCharVar("TimStuff") == 2 then
			player:PrintToPlayer("That stuff has made a really good door for the hide away, and nothing blew up.",0, npc:getPacketName())
		elseif player:getCharVar("TimStuff") == 1 then
			player:PrintToPlayer("I'm going to need 4 matamata shells, along with 2 Joyous's Moss, and 2 Raaz Hides.",0, npc:getPacketName())
		elseif player:getCharVar("Mission1CState") == 2 then
			player:PrintToPlayer("I have been trying to fix that old warmachine stranded by the river there for weeks...",0, npc:getPacketName())
			player:PrintToPlayer("However, I have decided to give up on that old thing as supplies are still to limited.", 13)
			player:timer(2000, function(player)
				player:PrintToPlayer("A few more people came from the mainland recently and we've been able to make a hidden shelter for them.", 13)
				player:PrintToPlayer("What we need at this point is not safe to get. To help hide the scent from the local... animals...", 13) 
			end)
			player:timer(4000, function(player)
				player:PrintToPlayer("I'm going to need 4 matamata shells, along with 2 Joyous's Moss, and 2 Raaz Hides.", 13)
			end)
			player:setCharVar("TimStuff", 1)
		else
			player:PrintToPlayer("Still don't know how that last explosion did this...",0, npc:getPacketName())
		end		
	end,  
	
    })
    utils.unused(Timmy)
end)

return m